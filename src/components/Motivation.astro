---
import { presentations, labels } from "../data/presentation";

const motivationDE = presentations.de.motivation;
const motivationEN = presentations.en.motivation;
const labelsDE = labels.de.motivation;
const labelsEN = labels.en.motivation;

const sections = [
  {
    id: "motivation-0",
    titleDE: labelsDE.sections.position.title,
    titleEN: labelsEN.sections.position.title,
    subtitleDE: labelsDE.sections.position.subtitle,
    subtitleEN: labelsEN.sections.position.subtitle,
    itemsDE: motivationDE.position,
    itemsEN: motivationEN.position,
    color: "var(--ctp-green)",
    icon: "M13 10V3L4 14h7v7l9-11h-7z",
  },
  {
    id: "motivation-1",
    titleDE: labelsDE.sections.expectations.title,
    titleEN: labelsEN.sections.expectations.title,
    subtitleDE: labelsDE.sections.expectations.subtitle,
    subtitleEN: labelsEN.sections.expectations.subtitle,
    itemsDE: motivationDE.expectations,
    itemsEN: motivationEN.expectations,
    color: "var(--ctp-blue)",
    icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
  },
  {
    id: "motivation-2",
    titleDE: labelsDE.sections.challenges.title,
    titleEN: labelsEN.sections.challenges.title,
    subtitleDE: labelsDE.sections.challenges.subtitle,
    subtitleEN: labelsEN.sections.challenges.subtitle,
    itemsDE: motivationDE.challenges,
    itemsEN: motivationEN.challenges,
    color: "var(--ctp-peach)",
    icon: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",
  },
];
---

<!-- Progress Indicator (right side) -->
<div id="motivation-progress" class="fixed right-6 top-1/2 -translate-y-1/2 z-50 hidden lg:flex flex-col gap-3">
  {sections.map((section, index) => (
    <button
      class="motivation-progress-dot group relative w-3 h-3 rounded-full bg-[var(--ctp-surface2)] transition-all duration-300 hover:bg-[var(--ctp-overlay0)]"
      data-index={index}
      aria-label={`Go to ${section.titleDE}`}
    >
      <span
        class="absolute right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm text-[var(--color-text-muted)] bg-[var(--color-surface)] px-2 py-1 rounded"
        data-i18n={`mot-tooltip-${index}`}
        data-de={`${labelsDE.questionLabel} ${index + 1}`}
        data-en={`${labelsEN.questionLabel} ${index + 1}`}
      >
        {labelsDE.questionLabel} {index + 1}
      </span>
    </button>
  ))}
</div>

<!-- Fixed Scroll Arrow (bottom center) -->
<a
  id="motivation-scroll-arrow"
  href="#motivation-0"
  class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 hidden text-[var(--ctp-overlay0)] hover:text-[var(--ctp-mauve)] transition-all duration-300 hover:scale-110"
  aria-label="Scroll to next section"
>
  <svg class="w-8 h-8 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
  </svg>
</a>

<!-- Fixed arrow for Motivation Header -->
<a
  id="motivation-header-arrow"
  href="#motivation-0"
  class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 hidden text-[var(--ctp-overlay0)] hover:text-[var(--ctp-mauve)] transition-all duration-300 hover:scale-110"
  aria-label="Start exploring motivation"
>
  <svg class="w-8 h-8 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
  </svg>
</a>

<!-- Section Header (Full Screen) -->
<section id="motivation" class="min-h-[calc(100vh-4rem)] flex items-center justify-center px-4 scroll-mt-16">
  <div class="max-w-4xl mx-auto text-center">
    <p
      class="fade-in font-mono text-sm text-[var(--ctp-mauve)] uppercase tracking-widest mb-4"
      data-i18n="mot-part"
      data-de={labelsDE.partLabel}
      data-en={labelsEN.partLabel}
    >
      {labelsDE.partLabel}
    </p>
    <h3
      class="fade-in text-4xl sm:text-5xl lg:text-6xl font-bold text-[var(--color-text)] mb-6"
      data-i18n="mot-title"
      data-de={labelsDE.title}
      data-en={labelsEN.title}
    >
      {labelsDE.title}
    </h3>
    <p
      class="fade-in text-lg text-[var(--color-text-muted)] max-w-2xl mx-auto"
      data-i18n="mot-subtitle"
      data-de={labelsDE.subtitle}
      data-en={labelsEN.subtitle}
    >
      {labelsDE.subtitle}
    </p>
  </div>
</section>

<!-- Motivation Sections (Centered Statement Layout) -->
{sections.map((section, index) => (
  <section
    class="motivation-section min-h-[calc(100dvh-4rem)] lg:min-h-[75vh] flex items-center justify-center px-4 py-8 lg:py-12 relative scroll-mt-16"
    data-index={index}
    id={section.id}
  >
    <!-- Background accent -->
    <div
      class="absolute inset-0 opacity-0 transition-opacity duration-1000 pointer-events-none"
      style={`background: radial-gradient(ellipse at 30% 40%, color-mix(in srgb, ${section.color} 10%, transparent), transparent 50%), radial-gradient(ellipse at 70% 60%, color-mix(in srgb, ${section.color} 6%, transparent), transparent 60%);`}
      data-bg
    />

    <!-- Centered content -->
    <div class="max-w-3xl mx-auto w-full relative text-center">

      <!-- Question indicator -->
      <div class="motivation-content opacity-0 translate-y-8 transition-all duration-700 ease-out">
        <div class="inline-flex items-center gap-2 mb-6">
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center"
            style={`background-color: ${section.color}20;`}
          >
            <svg
              class="w-5 h-5"
              style={`color: ${section.color};`}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              stroke-width="2"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d={section.icon} />
            </svg>
          </div>
          <span
            class="font-mono text-xs text-[var(--ctp-overlay0)] uppercase tracking-wider"
            data-i18n={`mot-qlabel-${index}`}
            data-de={`${labelsDE.questionLabel} ${index + 1} von 3`}
            data-en={`${labelsEN.questionLabel} ${index + 1} of 3`}
          >
            {labelsDE.questionLabel} {index + 1} von 3
          </span>
        </div>

        <!-- Main question - large typography -->
        <h3
          class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-3 leading-tight"
          style={`color: ${section.color};`}
          data-i18n={`mot-sec-title-${index}`}
          data-de={section.titleDE}
          data-en={section.titleEN}
        >
          {section.titleDE}
        </h3>

        <!-- Subtitle -->
        <p
          class="text-base lg:text-lg text-[var(--color-text-muted)] italic mb-12"
          data-i18n={`mot-sec-sub-${index}`}
          data-de={section.subtitleDE}
          data-en={section.subtitleEN}
        >
          {section.subtitleDE}
        </p>
      </div>

      <!-- Statement cards - stacked, centered -->
      <div class="space-y-4 max-w-2xl mx-auto">
        {section.itemsDE.map((item, itemIndex) => (
          <div
            class="motivation-item opacity-0 translate-y-4 transition-all duration-500"
            style={`transition-delay: ${itemIndex * 100 + 200}ms;`}
          >
            <div
              class="bg-[var(--color-surface)] rounded-xl border-l-4 p-5 lg:p-6 text-left shadow-sm hover:shadow-md transition-shadow"
              style={`border-color: ${section.color};`}
            >
              <div class="flex items-start gap-4">
                <span
                  class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm"
                  style={`background-color: ${section.color};`}
                >
                  {itemIndex + 1}
                </span>
                <p
                  class="text-base lg:text-lg text-[var(--color-text)] leading-relaxed pt-1"
                  data-i18n={`mot-item-${index}-${itemIndex}`}
                  data-de={item}
                  data-en={section.itemsEN[itemIndex] || item}
                >
                  {item}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>

    </div>
  </section>
))}

<style>
  .motivation-section.in-view .motivation-content {
    opacity: 1;
    transform: translateY(0);
  }

  .motivation-section.in-view .motivation-item {
    opacity: 1;
    transform: translateY(0);
  }

  .motivation-section.in-view [data-bg] {
    opacity: 1;
  }

  .motivation-progress-dot.active {
    width: 0.75rem;
    height: 1.5rem;
    border-radius: 0.375rem;
  }
</style>

<script>
  function initMotivationScrolling() {
    const sections = document.querySelectorAll('.motivation-section');
    const progressDots = document.querySelectorAll('.motivation-progress-dot');
    const progressContainer = document.getElementById('motivation-progress');
    const scrollArrow = document.getElementById('motivation-scroll-arrow');
    const headerArrow = document.getElementById('motivation-header-arrow');
    const motivationHeader = document.getElementById('motivation');

    if (!sections.length) return;

    // Header arrow visibility - show when motivation header is visible, hide when entering sections
    if (motivationHeader && headerArrow) {
      const headerObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              headerArrow.style.display = 'block';
            } else {
              headerArrow.style.display = 'none';
            }
          });
        },
        { threshold: 0.5 }
      );
      headerObserver.observe(motivationHeader);
    }

    // Adjust observer thresholds for mobile vs desktop
    const isMobile = window.innerWidth < 768;
    const observerThreshold = isMobile ? 0.15 : 0.3;
    const observerRootMargin = isMobile ? '-10% 0px -10% 0px' : '-20% 0px -20% 0px';

    // Intersection Observer for sections
    const sectionObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('in-view');

            const index = parseInt(entry.target.getAttribute('data-index') || '0');

            // Update progress dots
            const colors = ['var(--ctp-green)', 'var(--ctp-blue)', 'var(--ctp-peach)'];
            progressDots.forEach((dot, i) => {
              dot.classList.toggle('active', i === index);
              if (i === index) {
                (dot as HTMLElement).style.backgroundColor = colors[i];
              } else {
                (dot as HTMLElement).style.backgroundColor = '';
              }
            });

            // Update scroll arrow href
            if (scrollArrow) {
              const nextIndex = index + 1;
              if (nextIndex < sections.length) {
                scrollArrow.setAttribute('href', `#motivation-${nextIndex}`);
              } else {
                scrollArrow.setAttribute('href', '#leadership');
              }
            }
          }
        });
      },
      {
        threshold: observerThreshold,
        rootMargin: observerRootMargin
      }
    );

    sections.forEach((section) => {
      sectionObserver.observe(section);
    });

    // Show/hide navigation elements
    const lastSection = sections[sections.length - 1];
    const firstSection = sections[0];

    // Only show when entering actual motivation sections (not header)
    const showObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            if (scrollArrow) scrollArrow.style.display = 'block';
            if (progressContainer) progressContainer.style.display = 'flex';
          }
        });
      },
      { threshold: observerThreshold }
    );

    sections.forEach((section) => showObserver.observe(section));

    // Hide when past last section
    const hideObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting && entry.boundingClientRect.top < 0) {
            if (scrollArrow) scrollArrow.style.display = 'none';
            if (progressContainer) progressContainer.style.display = 'none';
          }
        });
      },
      { threshold: 0 }
    );

    if (lastSection) hideObserver.observe(lastSection);

    // Hide when above first motivation section (scrolled back up)
    const hideAboveObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting && entry.boundingClientRect.top > 0) {
            if (scrollArrow) scrollArrow.style.display = 'none';
            if (progressContainer) progressContainer.style.display = 'none';
          }
        });
      },
      { threshold: 0 }
    );

    if (firstSection) hideAboveObserver.observe(firstSection);

    // Click to navigate (progress dots)
    progressDots.forEach((dot) => {
      dot.addEventListener('click', () => {
        const index = dot.getAttribute('data-index');
        const targetSection = document.querySelector(`.motivation-section[data-index="${index}"]`);
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  }

  function initMotivationI18n() {
    const STORAGE_KEY = "presentation-language";

    function getLanguage(): "de" | "en" {
      const stored = localStorage.getItem(STORAGE_KEY);
      return stored === "en" ? "en" : "de";
    }

    function updateContent(lang: "de" | "en") {
      document.querySelectorAll("[data-i18n^='mot-']").forEach((el) => {
        const text = el.getAttribute(`data-${lang}`);
        if (text) el.textContent = text;
      });
    }

    // Initialize
    updateContent(getLanguage());

    // Listen for language changes
    window.addEventListener("languageChange", (e: Event) => {
      const detail = (e as CustomEvent).detail;
      if (detail?.language) {
        updateContent(detail.language);
      }
    });
  }

  initMotivationScrolling();
  initMotivationI18n();
  document.addEventListener('astro:after-swap', () => {
    initMotivationScrolling();
    initMotivationI18n();
  });
</script>
